<link rel="stylesheet" href="../css/navbar.css" />

<nav class="navbar-main">
    <ul class="navbar-nav">
        <li class="logo">
            <a href="#" class="nav-link">
                <span class="link-text logo-text">ThyroidSpot</span>
                <svg aria-hidden="true" focusable="false" data-prefix="fad" data-icon="angle-double-right" role="img" xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 448 512" class="svg-inline--fa fa-angle-double-right fa-w-14 fa-5x">
                    <g class="fa-group">
                        <path fill="currentColor" d="M224 273L88.37 409a23.78 23.78 0 0 1-33.8 0L32 386.36a23.94 23.94 0 0 1 0-33.89l96.13-96.37L32 159.73a23.94 23.94 0 0 1 0-33.89l22.44-22.79a23.78 23.78 0 0 1 33.8 0L223.88 239a23.94 23.94 0 0 1 .1 34z"
                            class="fa-secondary"></path>
                        <path fill="currentColor" d="M415.89 273L280.34 409a23.77 23.77 0 0 1-33.79 0L224 386.26a23.94 23.94 0 0 1 0-33.89L320.11 256l-96-96.47a23.94 23.94 0 0 1 0-33.89l22.52-22.59a23.77 23.77 0 0 1 33.79 0L416 239a24 24 0 0 1-.11 34z"
                            class="fa-primary"></path>
                    </g>
                </svg>
            </a>
        </li>

        <!-- <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="svg-inline--fa fas fa-home fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Home</span>
            </a>
        </li> -->

        <li class="nav-item" id="nav-tab-account">
            <a href="index.html" class="nav-link">
                <i class="svg-inline--fa fas fa-user fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Account</span>
            </a>
        </li>

        <li class="nav-item" id="nav-tab-profile">
            <a href="profile.html" class="nav-link">
                <i class="svg-inline--fa fas fa-user fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Profile</span>
            </a>
        </li>

        <!-- Only for Patients -->
        <li class="nav-item" id="nav-tab-health">
            <a href="" class="nav-link">
                <i class="svg-inline--fa fas fa-notes-medical fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Health</span>
            </a>
        </li>

        <li class="nav-item" id="nav-tab-diseases">
            <a href="../html-pages/disease.html" class="nav-link">
                <i class="svg-inline--fa fas fa-lungs-virus fa-primary fa-w-16 fa-2x fa-rotate-180"></i>
                <span class="link-text">Diseases</span>
            </a>
        </li>

        <!-- Only for Clinicians -->
        <li class="nav-item" id="nav-tab-patients">
            <a href="#" class="nav-link">
                <i class="svg-inline--fa fas fa-file-medical-alt fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Patients</span>
            </a>
        </li>

        <!-- Only for Admins -->
        <li class="nav-item" id="nav-tab-manage">
            <a href="manage.html" class="nav-link">
                <i class="svg-inline--fa fas fa-edit fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">Manage</span>
            </a>
        </li>

        <li class="nav-item" style="margin-top: auto;">
            <a href="about.html" class="nav-link">
                <i class="svg-inline--fa fas fa-question-circle fa-primary fa-w-16 fa-2x"></i>
                <span class="link-text">About</span>
            </a>
        </li>
        <li class="nav-item" id="nav-tab-logout">
            <a href="#" class="nav-link">
                <i class="svg-inline--fa fas fa-sign-out-alt fa-primary fa-w-16 fa-2x logout-logo"></i>
                <span class="link-text">Logout</span>
            </a>
        </li>


    </ul>
</nav>
<!-- When loading, this animation will be activated. -->
<div class="loader-wrapper">
    <span class="loader"><span class="loader-inner"></span></span>
</div>

<!-- Only need to initialize it once at navbar since navbar will be in all other pages. -->
<script src="../js/firebase-init.js"></script>

<script src="../js/firebase-log-state.js"></script>

<!-- <script src="../js/firebase-api.js"></script> -->
<script>
    // LOGOUT FUNCTION
    const btnLogout = document.getElementById("nav-tab-logout");
    btnLogout.addEventListener("click", e => {
        firebase.auth().signOut().then(function () {
            // Sign-out successful.
            console.log("Logged Out");
            window.location.href = 'index.html';

        }).catch(function (error) {
            console.log("Error occurred when logging out");
        });
    });
</script>


<script>
    $(window).on("load", function () {
        $(".loader-wrapper").fadeOut("slow");
    });


    function navigation_control() {
        /* Check if user is logged in or not. */
        user_logged_in = sessionStorage.getItem("user_logged_in");

        /* Check user's account type. */
        user_account_type = sessionStorage.getItem("user_account_type");

        // If user is *not* logged in, "Logout" button in navbar will not show. 
        // If user is *not* logged in, "Profile" button in navbar will not show. 
        if (user_logged_in == "n") {
            document.getElementById('nav-tab-logout').style.display = "none";
            document.getElementById('nav-tab-profile').style.display = "none";
        }

        // If user *is* logged in, "Account" button (to login/register) in navbar will not show. 
        if (user_logged_in == "y") {
            document.getElementById('nav-tab-account').style.display = "none";
        }


        /* If user is logged in, check what account type user is (admin, clinician or patient). */

        // If user is *not* logged in OR account type is not patient, "Health" button (used by account_type="patient") in navbar will not show.
        if (user_logged_in == "n" || user_account_type != "patient") {
            document.getElementById('nav-tab-health').style.display = "none";
            document.getElementById('nav-tab-diseases').style.display = "none";
        }

        // If user is *not* logged in OR account type is not clinician, "Patients" button (used by account_type="clinician") in navbar will not show.
        if (user_logged_in == "n" || user_account_type != "clinician") {
            document.getElementById('nav-tab-patients').style.display = "none";
        }

        // If user is *not* logged in OR account type is not admin, "Manage" button (used by account_type="admin") in navbar will not show.
        if (user_logged_in == "n" || user_account_type != "admin") {
            document.getElementById('nav-tab-manage').style.display = "none";
        }


        // More specific navigation control.
        const currentLoc = window.location.href;
        console.log(currentLoc)
        if (currentLoc == "http://127.0.0.1:5500/html-pages/index.html" && user_logged_in == 'y') {
            window.location.href = "profile.html";
        }
        if (currentLoc == "http://127.0.0.1:5500/html-pages/profile.html" && user_logged_in == 'n') {
            window.location.href = "index.html";
        }
        // User not logged in.

        // If user is either not logged in or account type is not admin, don't let them go manage.html.
        if (user_logged_in == 'n' || user_account_type != "admin") {
            // Blocked URLs.
            if (currentLoc == "http://127.0.0.1:5500/html-pages/manage.html") {
                window.location.href = "index.html";
            }
        }

        // If user is either not logged in or account type is not clinician, don't let them go patientinfo.html.
        if (user_logged_in == 'n' || user_account_type != "clinician") {
            // Blocked URLs.
            if (currentLoc == "http://127.0.0.1:5500/html-pages/patientinfo.html") {
                window.location.href = "index.html";
            }
        }

        // If user is either not logged in or account type is not patient, don't let them go disease.html.
        if (user_logged_in == 'n' || user_account_type != "patient") {
            // Blocked URLs.
            if (currentLoc == "http://127.0.0.1:5500/html-pages/disease.html") {
                window.location.href = "index.html";
            }
        }

    }

    // IF USER IS LOGGED IN BUT NO ROLES, WAIT AWHILE.
    if (sessionStorage.getItem("user_account_type") === "none" && sessionStorage.getItem("user_logged_in") === 'y') {
        setTimeout(function () {
            navigation_control();
        }, 1000);
    }
    else {
        navigation_control();
    }



</script>