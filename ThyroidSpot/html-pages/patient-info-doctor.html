<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Imports -->
<!-- Imports -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="../css/style.css" />
<link rel="stylesheet" href="../css/patientinfo.css" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap" />
<script src="https://kit.fontawesome.com/a076d05399.js"></script>


<script src="https://printjs-4de6.kxcdn.com/print.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://printjs-4de6.kxcdn.com/print.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js" integrity="sha512-G8JE1Xbr0egZE5gNGyUm1fF764iHVfRXshIoUWCTPAbKkkItp/6qal5YAHXrxEu4HNfPTQs6HOu3D5vCGS1j3w==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js" integrity="sha512-vBmx0N/uQOXznm/Nbkp7h0P1RfLSj0HQrFSzV8m7rOGyj30fYAOKHYvCNez+yM8IrfnW0TCodDEjRqf6fodf/Q==" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.css" integrity="sha512-SUJFImtiT87gVCOXl3aGC00zfDl6ggYAw5+oheJvRJ8KBXZrr/TMISSdVJ5bBarbQDRC2pR5Kto3xTR0kpZInA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js" integrity="sha512-QEiC894KVkN9Tsoi6+mKf8HaCLJvyA6QIRzY5KrfINXYuP9NxdIkRQhGq3BZi0J4I7V5SidGM3XUQ5wFiMDuWg==" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css" integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w==" crossorigin="anonymous" />


<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
<script type="text/javascript" src="../js/patient-information-function.js"></script>


    <title>Thyroid-SPOT</title>
</head>

<body>
    <div id="navbar-html"></div>
    <main>
        <!--Patient Cards-->
        <div id="patientCardContent" class="container">
            <h2 id="patient-name" style='text-align: center'>username</h2>
            <table class='infoTable'>
                <tr>
                <td id="patient-ic-number" class='shiftedrow' style='padding-left: -5px'>IC number: </td>
                <td id="patient-diagnosis" class='shiftedrow'>Diagnosis: </td>
                <td id="patient-date-of-birth" class='shiftedrow'>D.O.B: </td>
                <td id="patient-gender" class='shiftedrow'>Gender: </td>
                <td id="patient-blood-type" class='shiftedrow'>Blood Type: </td>
            </tr>
        </table>
        </div>

        <div id="searchRPTcontain">
            <div id="searchInput">
            <input id="searchInputBox" onkeyup="searchPatientReport();" placeholder="Search Date...">
            </div>
        </div>

        <div id="reportcontainer">
            
            <div id="historycontainer">
               <!-- <table class='centerTable' style="margin-top: 1em;">
                    <tr><th id="labelDate" >Date</th>
                        <th id="labelFT4" >FT4</th>
                        <th id="labelTSH">TSH</th>
                        <th id="labelDrug">Drug Dose</th>
                </table> -->
                <div id="prescriptionButton"></div>
                <table id="class-report" class="table table-md" style="margin-top: 1em;">
                    <thead>
                    <tr>
                        <th class="th-sm">Date</th>
                        <th class="th-sm">FT4</th>
                        <th class="th-sm">TSH</th>
                    </tr>
                    </thead>
                    <tbody id="dosagehist"></tbody>
                </table>
                <hr>
                <!-- <div id="dosagehist">
                </div> -->
            </div>
            <div id="openGraphModalBtn">
                <canvas id="graphcontainer" >
                    <!--<h2 style="text-align: center;">Graph over here</h2>-->
                </canvas>
                <table class="table">
                    <tbody>
                        <tr>
                            <th scope="row">Name:</th>
                            <td id="tableName">x</td>
                            <td><b>Phi:</b></td>
                            <td id="tablePhiValue"></td>
                        </tr>
                        <tr>
                            <th scope="row">Birthdate:</th>
                            <td id="tableBirthDate">x</td>
                            <td><b>S:</b></td>
                            <td id="tableSValue" >12.22</td>
                        </tr>
                        <tr>
                            <th scope="row">Gender:</th>
                            <td id="tableGender">x</td>
                            <td><b>Set Point FT4:</b></td>
                            <td id="tableFT4Value">12.22</td>
                        </tr>
                        <tr>
                            <th scope="row">Diagnosis:</th>
                            <td id="tableDiagnosis">x</td>
                            <td><b>Set Point TSH:</b></td>
                            <td id="tableTSHValue">12.22</td>
                        </tr>
                        <tr>
                            <th scope="row">Loop Gain:</th>
                            <td id="tableLoopGainValue">x</td>
                            <td><b>R2:</b></td>
                            <td id="tableR2Value">12.22</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>

        <!-- Modal For Create Patient Report-->
        <div class="modal fade" id="addPatientResultModal" tabindex="-1" role="dialog" aria-labelledby="abandonPatientModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="abandonPatientModalLabel">Add Results</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <!--Modal Body (Main Content)-->
                    <div class="modal-body">
                        <h2 id="diseaseName" style="text-align: center;">Create Health Report</h2>
                        <hr>
                        <form id="createnfotable" onsubmit="postPatientReport(); return false;">
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col" style="text-align: left;">
                                    <label>FT4:</label>
                                    <div>
                                    <input type="text" class="form-control" id="newFT4" style="width: 70%; display: inline;" placeholder="Enter FT4..." required>
                                    <select name="unitselection" id="newUnitDDL" style="float: inherit;">
                                        <option value="mU/L">mU/L</option>
                                        <option value="pmol/L" selected>pmol/L</option>
                                    </select>
                                    </div>
                                </div>
                            </div>

                            <br>
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col" style="text-align: left;">
                                    <label>TSH:</label>
                                    <div>
                                    <input type="text" class="form-control" id="newTSH" style="width: 70%; display: inline;" placeholder="Enter TSH..." required>
                                    <select name="unitselection" id="newUnit1DDL" style="float: inherit;">
                                        <option value="mU/L" selected>mU/L</option>
                                        <option value="pmol/L">pmol/L</option>
                                    </select>
                                    </div>
                                </div>
                            </div>
                            <br>
                        
                            <!-- FOR KAILONG: to be moved to clinician side -->
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col-md-6">
                                    <label>Drug:</label>
                                    <div>
                                    <select name="bloodtype" class="newDrugName">
                                        <option value="" selected disabled hidden>--Choose here--</option>
                                        <option value="carbimazole">carbimazole</option>
                                        <option value="methimazole">methimazole</option>
                                        <option value="thiamazole">thiamazole</option>
                                        <option value="propylthiouracil">propylthiouracil</option>
                                        <option value="levothyroxine">levothyroxine</option>
                                        <option value="liothyronine">liothyronine"</option>
                                        <option value="propranolol">propranolol</option>
                                        <option value="others">others</option>
                                    </select>
                                    </div>
                                </div>

                                <br class="divider">

                                <div class="col-md-6">
                                    <label>Tablets:</label>
                                    <div>
                                    <input type="text" class="newDrugDose" placeholder="Enter No..." required>
                                    </div>
                                </div> 
                            </div>
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col" style="text-align: left;">
                                    <label>Tablets per day:</label>
                                    <div>
                                    <input type="text" class="form-control newTabletsDay" placeholder="Enter prescription..." required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col" style="text-align: left;">
                                    <label>Remarks:</label>
                                    <div>
                                    <input type="text" class="form-control newRemarks" placeholder="Enter remarks...">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row col-xs-4  col-md-12">
                                <div class="col" style="text-align: left;">
                                    <label>Medicine image:</label>
                                    <div>
                                    <input type="file" name="files[]" class="form-control newDrugImage" required>
                                    </div>
                                </div>
                            </div>
                            <br>    
                            <div id="addon">
                            </div>
                        </div>
                            <div style="text-align: center; margin-bottom: 1em;">
                                <button id="addMoreRows" class="btn btn-secondary custom-class">Add another drug dose</button>
                            </div>
                            <div style="text-align: center; padding-bottom: 1em;">
                                <button class="btn btn-dark btn-SaveReport custom-class bold">Save Report</button>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>                    
            </div>

            <!-- Modal For Prescription -->
            <div class="modal fade bd-example-modal-lg" id="prescriptionModal" tabindex="-1" role="dialog" aria-labelledby="prescriptionModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title">Prescription</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body" id="export">
                        <table class="table table-sm" style="width: 95%; margin-left: auto; margin-right: auto;">
                            <tr>
                                <td style=" text-align:left; width: 60%;">Diagnosis:</td>
                                <td id="tdDiagnosis"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">Checkup date:</td>
                                <td id="tdCheckup"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">FT4:</td>
                                <td id="tdFt4"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">TSH:</td>
                                <td id="tdTsh" ></td>
                            </tr>
                        </table>
                        
                      <div class="table-responsive-sm">
                        <table class="table" style="background-color: none">
    
                            <!--Table head-->
                            <thead>
                              <tr>
                                <th style="width: 20%;">Drug Name</th>
                                
                                <th class="th-md">Pills</th>
    
                                <th class="th-md">Prescription</th>
    
                                <th style="width: 20%;">Image</th>
    
                                <th class="th-md">Remarks</th>
                                
                              </tr>
                            </thead>
                            <!--Table head-->
                          
                            <!--Table body-->
                            <tbody id="prescriptionTable" class="table-light" style="vertical-align: middle">
                              
                            </tbody>
                            <!--Table body-->
                          
                          
                          </table>
                          <!--Table-->
                          </div>
                        <div style="text-align: center;">
                            <button class="btn btn-info custom-class" onclick="exportData()"> Export to PDF </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
                </div>
            </div>    

            <!-- Diagnosis Modal -->
            <div class="modal fade" id="diagnosisModal" tabindex="-1" role="dialog" aria-labelledby="diagnosisModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title">Diagnosis</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-sm" style="width: 95%; margin-left: auto; margin-right: auto;">
                            <tr>
                                <td style=" text-align:left; width: 60%;">Diagnosis:</td>
                                <td id="diagnosisDisplay">test</td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">Date of Birth:</td>
                                <td id="tdDOB"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">Gender:</td>
                                <td id="tdGender"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">Blood Type:</td>
                                <td id="tdBloodType" ></td>
                            </tr>
                            <tr>
                                <td style="text-align:left;">Most Recent Appointment Date:</td>
                                <td id="tdAptDate" ></td>
                            </tr>
                        </table>
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
                </div>
            </div>

            <div id="GraphModal" class="w3-modal">
                <div class="w3-modal-content">
                    <div class="w3-container">
                        <span onclick="document.getElementById('GraphModal').style.display='none'" class="w3-button w3-display-topright">&times;</span>
                        <h2 style="text-align: center;">Dosage Chart</h2>
                        
                        <div class="modal-body" style="text-align: center">
                            <canvas id="graphcontainer1" >
                                <!--<h2 style="text-align: center;">Graph over here</h2>-->
                            </canvas>
                            <br>
                            <button class="btn btn-info btn-sm custom-class" id="exportcalc">Export chart calculations</button>
                        </div>
                    </div>
                </div>
            </div>

        <!--Drug Image modal-->
        <div id="modalImg" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Medicine Image</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" id="newImageModal">
                  <p>.</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="editImageBtn">Edit Image</button>
                  <button type="button" class="btn btn-secondary" id="closeImageBtn" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>


        <!--Edit / Delete Result modal-->
        <div id="editDeleteResultModal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit / Delete Results Modal</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="newFT4Value">FT4 Value</label>
                        <input type="number" class="form-control" id="newFT4Value" placeholder="Enter FT4 Value">
                      </div>
                      <div class="form-group">
                        <label for="newTSHValue">TSH Value</label>
                        <input type="number" class="form-control" id="newTSHValue" placeholder="Enter TSH Value">
                      </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger mr-auto" id="deleteResultBtn" onclick="deleteReport()">Delete</button>
                    <button type="button" class="btn btn-primary" id="deleteResultBtn" onclick="updateReport()">Update</button>
                    <button type="button" class="btn btn-secondary" id="closeImageBtn" data-dismiss="modal">Close</button>
                </div>
                </div>
            </div>
            </div>

                    <!--Edit Image modal-->
        <div id="updatemodalImg" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Medicine Image</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                    <form id="submitImage" onsubmit="updateMedicineImg(); return false;">
                    <div class="form-row col-xs-4  col-md-12">
                        <div class="col" style="text-align: left;">
                            <label>Medicine image:</label>
                            <div>
                            <input type="file" name="resume" class="form-control newDrugImage" required>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <button class="btn btn-primary custom-class">Save Image</button>
                    </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

           <!-- WARNING: exported data div, do not show, keep it display:none at all times-->
           <div style="display: none;">
            <div id="export1">
                <h2 style="text-align: center;">Test Results</h2>
                <table class="table table-sm" style="width: 50%; margin-left: auto; margin-right: auto; margin-bottom: 50px;">
                    <tr>
                        <td style=" text-align:left; vertical-align: top; width: 60%;">Diagnosis:</td>
                        <td id="exDiagnosis"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left;">Checkup date:</td>
                        <td id="exCheckup"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left;">FT4:</td>
                        <td id="exFt4"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left;">TSH:</td>
                        <td id="exTsh" ></td>
                    </tr>
                </table>
            
              <div class="table-responsive-sm">
                <h2 style="text-align: center;">Prescription</h2>
                <table id="exportDoseTable" class="table" style="width: 70%; margin-left: auto; margin-right: auto;">
                  </table>
                  <!--Table-->
                </div>
            </div>
        </div>
</div>
</div>
                    
    </main>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-firestore.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#navbar-html").load("../html-components/navbar.html");

            $("#footer-html").load("../html-components/footer.html");
        });
    </script>

    <script src="../js/clinician-algorithm.js"></script>

</body>

</html>